"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _components = require("payload/components");
const _elements = require("payload/components/elements");
const _graphics = require("payload/components/graphics");
const _hooks = require("payload/components/hooks");
const _utilities = require("payload/components/utilities");
const _utilities1 = require("payload/utilities");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _slate = require("slate");
const _slatereact = require("slate-react");
const _EnabledRelationshipsCondition = require("../../EnabledRelationshipsCondition");
const _UploadDrawer = require("./UploadDrawer");
require("./index.scss");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'rich-text-upload';
const initialParams = {
    depth: 0
};
const Element = (props)=>{
    const { attributes, children, element: { relationTo, value }, element, enabledCollectionSlugs, fieldProps } = props;
    const { collections, routes: { api }, serverURL } = (0, _utilities.useConfig)();
    const { i18n, t } = (0, _reacti18next.useTranslation)('fields');
    const [cacheBust, dispatchCacheBust] = (0, _react.useReducer)((state)=>state + 1, 0);
    const [relatedCollection, setRelatedCollection] = (0, _react.useState)(()=>collections.find((coll)=>coll.slug === relationTo));
    const drawerSlug = (0, _elements.useDrawerSlug)('upload-drawer');
    const [ListDrawer, ListDrawerToggler, { closeDrawer: closeListDrawer }] = (0, _elements.useListDrawer)({
        collectionSlugs: enabledCollectionSlugs,
        selectedCollection: relatedCollection.slug
    });
    const [DocumentDrawer, DocumentDrawerToggler, { closeDrawer }] = (0, _elements.useDocumentDrawer)({
        id: value?.id,
        collectionSlug: relatedCollection.slug
    });
    const editor = (0, _slatereact.useSlateStatic)();
    const selected = (0, _slatereact.useSelected)();
    const focused = (0, _slatereact.useFocused)();
    // Get the referenced document
    const [{ data }, { setParams }] = (0, _hooks.usePayloadAPI)(`${serverURL}${api}/${relatedCollection.slug}/${value?.id}`, {
        initialParams
    });
    const thumbnailSRC = (0, _hooks.useThumbnail)(relatedCollection, data);
    const removeUpload = (0, _react.useCallback)(()=>{
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        _slate.Transforms.removeNodes(editor, {
            at: elementPath
        });
    }, [
        editor,
        element
    ]);
    const updateUpload = (0, _react.useCallback)((json)=>{
        const { doc } = json;
        const newNode = {
            fields: doc
        };
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        _slate.Transforms.setNodes(editor, newNode, {
            at: elementPath
        });
        // setRelatedCollection(collections.find((coll) => coll.slug === collectionConfig.slug));
        setParams({
            ...initialParams,
            cacheBust
        });
        dispatchCacheBust();
        closeDrawer();
    }, [
        editor,
        element,
        setParams,
        cacheBust,
        closeDrawer
    ]);
    const swapUpload = _react.default.useCallback(({ collectionConfig, docID })=>{
        const newNode = {
            children: [
                {
                    text: ' '
                }
            ],
            relationTo: collectionConfig.slug,
            type: 'upload',
            value: {
                id: docID
            }
        };
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        setRelatedCollection(collections.find((coll)=>coll.slug === collectionConfig.slug));
        _slate.Transforms.setNodes(editor, newNode, {
            at: elementPath
        });
        dispatchCacheBust();
        closeListDrawer();
    }, [
        closeListDrawer,
        editor,
        element,
        collections
    ]);
    const customFields = fieldProps?.admin?.upload?.collections?.[relatedCollection.slug]?.fields;
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            baseClass,
            selected && focused && `${baseClass}--selected`
        ].filter(Boolean).join(' '),
        contentEditable: false,
        ...attributes
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__card`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__topRow`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__thumbnail`
    }, thumbnailSRC ? /*#__PURE__*/ _react.default.createElement("img", {
        alt: data?.filename,
        src: thumbnailSRC
    }) : /*#__PURE__*/ _react.default.createElement(_graphics.FileGraphic, null)), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__topRowRightPanel`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__collectionLabel`
    }, (0, _utilities1.getTranslation)(relatedCollection.labels.singular, i18n)), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__actions`
    }, customFields?.length > 0 && /*#__PURE__*/ _react.default.createElement(_elements.DrawerToggler, {
        className: `${baseClass}__upload-drawer-toggler`,
        disabled: fieldProps?.admin?.readOnly,
        slug: drawerSlug
    }, /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        el: "div",
        icon: "edit",
        onClick: (e)=>{
            e.preventDefault();
        },
        round: true,
        tooltip: t('fields:editRelationship')
    })), /*#__PURE__*/ _react.default.createElement(ListDrawerToggler, {
        className: `${baseClass}__list-drawer-toggler`,
        disabled: fieldProps?.admin?.readOnly
    }, /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        disabled: fieldProps?.admin?.readOnly,
        el: "div",
        icon: "swap",
        onClick: ()=>{
        // do nothing
        },
        round: true,
        tooltip: t('swapUpload')
    })), /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        className: `${baseClass}__removeButton`,
        disabled: fieldProps?.admin?.readOnly,
        icon: "x",
        onClick: (e)=>{
            e.preventDefault();
            removeUpload();
        },
        round: true,
        tooltip: t('removeUpload')
    })))), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__bottomRow`
    }, /*#__PURE__*/ _react.default.createElement(DocumentDrawerToggler, {
        className: `${baseClass}__doc-drawer-toggler`
    }, /*#__PURE__*/ _react.default.createElement("strong", null, data?.filename)))), children, value?.id && /*#__PURE__*/ _react.default.createElement(DocumentDrawer, {
        onSave: updateUpload
    }), /*#__PURE__*/ _react.default.createElement(ListDrawer, {
        onSelect: swapUpload
    }), /*#__PURE__*/ _react.default.createElement(_UploadDrawer.UploadDrawer, {
        drawerSlug: drawerSlug,
        relatedCollection: relatedCollection,
        ...props
    }));
};
const _default = (props)=>{
    return /*#__PURE__*/ _react.default.createElement(_EnabledRelationshipsCondition.EnabledRelationshipsCondition, {
        ...props,
        uploads: true
    }, /*#__PURE__*/ _react.default.createElement(Element, props));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9maWVsZC9lbGVtZW50cy91cGxvYWQvRWxlbWVudC9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBTYW5pdGl6ZWRDb2xsZWN0aW9uQ29uZmlnIH0gZnJvbSAncGF5bG9hZC90eXBlcydcbmltcG9ydCB0eXBlIHsgSFRNTEF0dHJpYnV0ZXMgfSBmcm9tICdyZWFjdCdcblxuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAncGF5bG9hZC9jb21wb25lbnRzJ1xuaW1wb3J0IHtcbiAgRHJhd2VyVG9nZ2xlcixcbiAgdXNlRG9jdW1lbnREcmF3ZXIsXG4gIHVzZURyYXdlclNsdWcsXG4gIHVzZUxpc3REcmF3ZXIsXG59IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy9lbGVtZW50cydcbmltcG9ydCB7IEZpbGVHcmFwaGljIH0gZnJvbSAncGF5bG9hZC9jb21wb25lbnRzL2dyYXBoaWNzJ1xuaW1wb3J0IHsgdXNlUGF5bG9hZEFQSSwgdXNlVGh1bWJuYWlsIH0gZnJvbSAncGF5bG9hZC9jb21wb25lbnRzL2hvb2tzJ1xuaW1wb3J0IHsgdXNlQ29uZmlnIH0gZnJvbSAncGF5bG9hZC9jb21wb25lbnRzL3V0aWxpdGllcydcbmltcG9ydCB7IGdldFRyYW5zbGF0aW9uIH0gZnJvbSAncGF5bG9hZC91dGlsaXRpZXMnXG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZVJlZHVjZXIsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyBUcmFuc2Zvcm1zIH0gZnJvbSAnc2xhdGUnXG5pbXBvcnQgeyBSZWFjdEVkaXRvciwgdXNlRm9jdXNlZCwgdXNlU2VsZWN0ZWQsIHVzZVNsYXRlU3RhdGljIH0gZnJvbSAnc2xhdGUtcmVhY3QnXG5cbmltcG9ydCB0eXBlIHsgRmllbGRQcm9wcyB9IGZyb20gJy4uLy4uLy4uLy4uL3R5cGVzJ1xuXG5pbXBvcnQgeyBFbmFibGVkUmVsYXRpb25zaGlwc0NvbmRpdGlvbiB9IGZyb20gJy4uLy4uL0VuYWJsZWRSZWxhdGlvbnNoaXBzQ29uZGl0aW9uJ1xuaW1wb3J0IHsgVXBsb2FkRHJhd2VyIH0gZnJvbSAnLi9VcGxvYWREcmF3ZXInXG5pbXBvcnQgJy4vaW5kZXguc2NzcydcblxuY29uc3QgYmFzZUNsYXNzID0gJ3JpY2gtdGV4dC11cGxvYWQnXG5cbmNvbnN0IGluaXRpYWxQYXJhbXMgPSB7XG4gIGRlcHRoOiAwLFxufVxuXG5leHBvcnQgdHlwZSBFbGVtZW50UHJvcHMgPSB7XG4gIGF0dHJpYnV0ZXM6IEhUTUxBdHRyaWJ1dGVzPEhUTUxEaXZFbGVtZW50PlxuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlXG4gIGVsZW1lbnQ6IGFueVxuICBlbmFibGVkQ29sbGVjdGlvblNsdWdzOiBzdHJpbmdbXVxuICBmaWVsZFByb3BzOiBGaWVsZFByb3BzXG59XG5cbmNvbnN0IEVsZW1lbnQ6IFJlYWN0LkZDPEVsZW1lbnRQcm9wcz4gPSAocHJvcHMpID0+IHtcbiAgY29uc3Qge1xuICAgIGF0dHJpYnV0ZXMsXG4gICAgY2hpbGRyZW4sXG4gICAgZWxlbWVudDogeyByZWxhdGlvblRvLCB2YWx1ZSB9LFxuICAgIGVsZW1lbnQsXG4gICAgZW5hYmxlZENvbGxlY3Rpb25TbHVncyxcbiAgICBmaWVsZFByb3BzLFxuICB9ID0gcHJvcHNcblxuICBjb25zdCB7XG4gICAgY29sbGVjdGlvbnMsXG4gICAgcm91dGVzOiB7IGFwaSB9LFxuICAgIHNlcnZlclVSTCxcbiAgfSA9IHVzZUNvbmZpZygpXG4gIGNvbnN0IHsgaTE4biwgdCB9ID0gdXNlVHJhbnNsYXRpb24oJ2ZpZWxkcycpXG4gIGNvbnN0IFtjYWNoZUJ1c3QsIGRpc3BhdGNoQ2FjaGVCdXN0XSA9IHVzZVJlZHVjZXIoKHN0YXRlKSA9PiBzdGF0ZSArIDEsIDApXG4gIGNvbnN0IFtyZWxhdGVkQ29sbGVjdGlvbiwgc2V0UmVsYXRlZENvbGxlY3Rpb25dID0gdXNlU3RhdGU8U2FuaXRpemVkQ29sbGVjdGlvbkNvbmZpZz4oKCkgPT5cbiAgICBjb2xsZWN0aW9ucy5maW5kKChjb2xsKSA9PiBjb2xsLnNsdWcgPT09IHJlbGF0aW9uVG8pLFxuICApXG5cbiAgY29uc3QgZHJhd2VyU2x1ZyA9IHVzZURyYXdlclNsdWcoJ3VwbG9hZC1kcmF3ZXInKVxuXG4gIGNvbnN0IFtMaXN0RHJhd2VyLCBMaXN0RHJhd2VyVG9nZ2xlciwgeyBjbG9zZURyYXdlcjogY2xvc2VMaXN0RHJhd2VyIH1dID0gdXNlTGlzdERyYXdlcih7XG4gICAgY29sbGVjdGlvblNsdWdzOiBlbmFibGVkQ29sbGVjdGlvblNsdWdzLFxuICAgIHNlbGVjdGVkQ29sbGVjdGlvbjogcmVsYXRlZENvbGxlY3Rpb24uc2x1ZyxcbiAgfSlcblxuICBjb25zdCBbRG9jdW1lbnREcmF3ZXIsIERvY3VtZW50RHJhd2VyVG9nZ2xlciwgeyBjbG9zZURyYXdlciB9XSA9IHVzZURvY3VtZW50RHJhd2VyKHtcbiAgICBpZDogdmFsdWU/LmlkLFxuICAgIGNvbGxlY3Rpb25TbHVnOiByZWxhdGVkQ29sbGVjdGlvbi5zbHVnLFxuICB9KVxuXG4gIGNvbnN0IGVkaXRvciA9IHVzZVNsYXRlU3RhdGljKClcbiAgY29uc3Qgc2VsZWN0ZWQgPSB1c2VTZWxlY3RlZCgpXG4gIGNvbnN0IGZvY3VzZWQgPSB1c2VGb2N1c2VkKClcblxuICAvLyBHZXQgdGhlIHJlZmVyZW5jZWQgZG9jdW1lbnRcbiAgY29uc3QgW3sgZGF0YSB9LCB7IHNldFBhcmFtcyB9XSA9IHVzZVBheWxvYWRBUEkoXG4gICAgYCR7c2VydmVyVVJMfSR7YXBpfS8ke3JlbGF0ZWRDb2xsZWN0aW9uLnNsdWd9LyR7dmFsdWU/LmlkfWAsXG4gICAgeyBpbml0aWFsUGFyYW1zIH0sXG4gIClcblxuICBjb25zdCB0aHVtYm5haWxTUkMgPSB1c2VUaHVtYm5haWwocmVsYXRlZENvbGxlY3Rpb24sIGRhdGEpXG5cbiAgY29uc3QgcmVtb3ZlVXBsb2FkID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IGVsZW1lbnRQYXRoID0gUmVhY3RFZGl0b3IuZmluZFBhdGgoZWRpdG9yLCBlbGVtZW50KVxuXG4gICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IsIHsgYXQ6IGVsZW1lbnRQYXRoIH0pXG4gIH0sIFtlZGl0b3IsIGVsZW1lbnRdKVxuXG4gIGNvbnN0IHVwZGF0ZVVwbG9hZCA9IHVzZUNhbGxiYWNrKFxuICAgIChqc29uKSA9PiB7XG4gICAgICBjb25zdCB7IGRvYyB9ID0ganNvblxuXG4gICAgICBjb25zdCBuZXdOb2RlID0ge1xuICAgICAgICBmaWVsZHM6IGRvYyxcbiAgICAgIH1cblxuICAgICAgY29uc3QgZWxlbWVudFBhdGggPSBSZWFjdEVkaXRvci5maW5kUGF0aChlZGl0b3IsIGVsZW1lbnQpXG5cbiAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCBuZXdOb2RlLCB7IGF0OiBlbGVtZW50UGF0aCB9KVxuXG4gICAgICAvLyBzZXRSZWxhdGVkQ29sbGVjdGlvbihjb2xsZWN0aW9ucy5maW5kKChjb2xsKSA9PiBjb2xsLnNsdWcgPT09IGNvbGxlY3Rpb25Db25maWcuc2x1ZykpO1xuXG4gICAgICBzZXRQYXJhbXMoe1xuICAgICAgICAuLi5pbml0aWFsUGFyYW1zLFxuICAgICAgICBjYWNoZUJ1c3QsIC8vIGRvIHRoaXMgdG8gZ2V0IHRoZSB1c2VQYXlsb2FkQVBJIHRvIHJlLWZldGNoIHRoZSBkYXRhIGV2ZW4gdGhvdWdoIHRoZSBVUkwgc3RyaW5nIGhhc24ndCBjaGFuZ2VkXG4gICAgICB9KVxuXG4gICAgICBkaXNwYXRjaENhY2hlQnVzdCgpXG4gICAgICBjbG9zZURyYXdlcigpXG4gICAgfSxcbiAgICBbZWRpdG9yLCBlbGVtZW50LCBzZXRQYXJhbXMsIGNhY2hlQnVzdCwgY2xvc2VEcmF3ZXJdLFxuICApXG5cbiAgY29uc3Qgc3dhcFVwbG9hZCA9IFJlYWN0LnVzZUNhbGxiYWNrKFxuICAgICh7IGNvbGxlY3Rpb25Db25maWcsIGRvY0lEIH0pID0+IHtcbiAgICAgIGNvbnN0IG5ld05vZGUgPSB7XG4gICAgICAgIGNoaWxkcmVuOiBbeyB0ZXh0OiAnICcgfV0sXG4gICAgICAgIHJlbGF0aW9uVG86IGNvbGxlY3Rpb25Db25maWcuc2x1ZyxcbiAgICAgICAgdHlwZTogJ3VwbG9hZCcsXG4gICAgICAgIHZhbHVlOiB7IGlkOiBkb2NJRCB9LFxuICAgICAgfVxuXG4gICAgICBjb25zdCBlbGVtZW50UGF0aCA9IFJlYWN0RWRpdG9yLmZpbmRQYXRoKGVkaXRvciwgZWxlbWVudClcblxuICAgICAgc2V0UmVsYXRlZENvbGxlY3Rpb24oY29sbGVjdGlvbnMuZmluZCgoY29sbCkgPT4gY29sbC5zbHVnID09PSBjb2xsZWN0aW9uQ29uZmlnLnNsdWcpKVxuXG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwgbmV3Tm9kZSwgeyBhdDogZWxlbWVudFBhdGggfSlcblxuICAgICAgZGlzcGF0Y2hDYWNoZUJ1c3QoKVxuICAgICAgY2xvc2VMaXN0RHJhd2VyKClcbiAgICB9LFxuICAgIFtjbG9zZUxpc3REcmF3ZXIsIGVkaXRvciwgZWxlbWVudCwgY29sbGVjdGlvbnNdLFxuICApXG5cbiAgY29uc3QgY3VzdG9tRmllbGRzID0gZmllbGRQcm9wcz8uYWRtaW4/LnVwbG9hZD8uY29sbGVjdGlvbnM/LltyZWxhdGVkQ29sbGVjdGlvbi5zbHVnXT8uZmllbGRzXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e1tiYXNlQ2xhc3MsIHNlbGVjdGVkICYmIGZvY3VzZWQgJiYgYCR7YmFzZUNsYXNzfS0tc2VsZWN0ZWRgXVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgIC5qb2luKCcgJyl9XG4gICAgICBjb250ZW50RWRpdGFibGU9e2ZhbHNlfVxuICAgICAgey4uLmF0dHJpYnV0ZXN9XG4gICAgPlxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2NhcmRgfT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3RvcFJvd2B9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X190aHVtYm5haWxgfT5cbiAgICAgICAgICAgIHt0aHVtYm5haWxTUkMgPyA8aW1nIGFsdD17ZGF0YT8uZmlsZW5hbWV9IHNyYz17dGh1bWJuYWlsU1JDfSAvPiA6IDxGaWxlR3JhcGhpYyAvPn1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fdG9wUm93UmlnaHRQYW5lbGB9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2NvbGxlY3Rpb25MYWJlbGB9PlxuICAgICAgICAgICAgICB7Z2V0VHJhbnNsYXRpb24ocmVsYXRlZENvbGxlY3Rpb24ubGFiZWxzLnNpbmd1bGFyLCBpMThuKX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2FjdGlvbnNgfT5cbiAgICAgICAgICAgICAge2N1c3RvbUZpZWxkcz8ubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgICAgICAgPERyYXdlclRvZ2dsZXJcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fdXBsb2FkLWRyYXdlci10b2dnbGVyYH1cbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtmaWVsZFByb3BzPy5hZG1pbj8ucmVhZE9ubHl9XG4gICAgICAgICAgICAgICAgICBzbHVnPXtkcmF3ZXJTbHVnfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgICAgZWw9XCJkaXZcIlxuICAgICAgICAgICAgICAgICAgICBpY29uPVwiZWRpdFwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgIHJvdW5kXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA9e3QoJ2ZpZWxkczplZGl0UmVsYXRpb25zaGlwJyl9XG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvRHJhd2VyVG9nZ2xlcj5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPExpc3REcmF3ZXJUb2dnbGVyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19saXN0LWRyYXdlci10b2dnbGVyYH1cbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17ZmllbGRQcm9wcz8uYWRtaW4/LnJlYWRPbmx5fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtmaWVsZFByb3BzPy5hZG1pbj8ucmVhZE9ubHl9XG4gICAgICAgICAgICAgICAgICBlbD1cImRpdlwiXG4gICAgICAgICAgICAgICAgICBpY29uPVwic3dhcFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICByb3VuZFxuICAgICAgICAgICAgICAgICAgdG9vbHRpcD17dCgnc3dhcFVwbG9hZCcpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvTGlzdERyYXdlclRvZ2dsZXI+XG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cImljb24tbGFiZWxcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fcmVtb3ZlQnV0dG9uYH1cbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17ZmllbGRQcm9wcz8uYWRtaW4/LnJlYWRPbmx5fVxuICAgICAgICAgICAgICAgIGljb249XCJ4XCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICByZW1vdmVVcGxvYWQoKVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgcm91bmRcbiAgICAgICAgICAgICAgICB0b29sdGlwPXt0KCdyZW1vdmVVcGxvYWQnKX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2JvdHRvbVJvd2B9PlxuICAgICAgICAgIDxEb2N1bWVudERyYXdlclRvZ2dsZXIgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19kb2MtZHJhd2VyLXRvZ2dsZXJgfT5cbiAgICAgICAgICAgIDxzdHJvbmc+e2RhdGE/LmZpbGVuYW1lfTwvc3Ryb25nPlxuICAgICAgICAgIDwvRG9jdW1lbnREcmF3ZXJUb2dnbGVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAge2NoaWxkcmVufVxuICAgICAge3ZhbHVlPy5pZCAmJiA8RG9jdW1lbnREcmF3ZXIgb25TYXZlPXt1cGRhdGVVcGxvYWR9IC8+fVxuICAgICAgPExpc3REcmF3ZXIgb25TZWxlY3Q9e3N3YXBVcGxvYWR9IC8+XG4gICAgICA8VXBsb2FkRHJhd2VyIGRyYXdlclNsdWc9e2RyYXdlclNsdWd9IHJlbGF0ZWRDb2xsZWN0aW9uPXtyZWxhdGVkQ29sbGVjdGlvbn0gey4uLnByb3BzfSAvPlxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IChwcm9wczogRWxlbWVudFByb3BzKTogUmVhY3QuUmVhY3ROb2RlID0+IHtcbiAgcmV0dXJuIChcbiAgICA8RW5hYmxlZFJlbGF0aW9uc2hpcHNDb25kaXRpb24gey4uLnByb3BzfSB1cGxvYWRzPlxuICAgICAgPEVsZW1lbnQgey4uLnByb3BzfSAvPlxuICAgIDwvRW5hYmxlZFJlbGF0aW9uc2hpcHNDb25kaXRpb24+XG4gIClcbn1cbiJdLCJuYW1lcyI6WyJiYXNlQ2xhc3MiLCJpbml0aWFsUGFyYW1zIiwiZGVwdGgiLCJFbGVtZW50IiwicHJvcHMiLCJhdHRyaWJ1dGVzIiwiY2hpbGRyZW4iLCJlbGVtZW50IiwicmVsYXRpb25UbyIsInZhbHVlIiwiZW5hYmxlZENvbGxlY3Rpb25TbHVncyIsImZpZWxkUHJvcHMiLCJjb2xsZWN0aW9ucyIsInJvdXRlcyIsImFwaSIsInNlcnZlclVSTCIsInVzZUNvbmZpZyIsImkxOG4iLCJ0IiwidXNlVHJhbnNsYXRpb24iLCJjYWNoZUJ1c3QiLCJkaXNwYXRjaENhY2hlQnVzdCIsInVzZVJlZHVjZXIiLCJzdGF0ZSIsInJlbGF0ZWRDb2xsZWN0aW9uIiwic2V0UmVsYXRlZENvbGxlY3Rpb24iLCJ1c2VTdGF0ZSIsImZpbmQiLCJjb2xsIiwic2x1ZyIsImRyYXdlclNsdWciLCJ1c2VEcmF3ZXJTbHVnIiwiTGlzdERyYXdlciIsIkxpc3REcmF3ZXJUb2dnbGVyIiwiY2xvc2VEcmF3ZXIiLCJjbG9zZUxpc3REcmF3ZXIiLCJ1c2VMaXN0RHJhd2VyIiwiY29sbGVjdGlvblNsdWdzIiwic2VsZWN0ZWRDb2xsZWN0aW9uIiwiRG9jdW1lbnREcmF3ZXIiLCJEb2N1bWVudERyYXdlclRvZ2dsZXIiLCJ1c2VEb2N1bWVudERyYXdlciIsImlkIiwiY29sbGVjdGlvblNsdWciLCJlZGl0b3IiLCJ1c2VTbGF0ZVN0YXRpYyIsInNlbGVjdGVkIiwidXNlU2VsZWN0ZWQiLCJmb2N1c2VkIiwidXNlRm9jdXNlZCIsImRhdGEiLCJzZXRQYXJhbXMiLCJ1c2VQYXlsb2FkQVBJIiwidGh1bWJuYWlsU1JDIiwidXNlVGh1bWJuYWlsIiwicmVtb3ZlVXBsb2FkIiwidXNlQ2FsbGJhY2siLCJlbGVtZW50UGF0aCIsIlJlYWN0RWRpdG9yIiwiZmluZFBhdGgiLCJUcmFuc2Zvcm1zIiwicmVtb3ZlTm9kZXMiLCJhdCIsInVwZGF0ZVVwbG9hZCIsImpzb24iLCJkb2MiLCJuZXdOb2RlIiwiZmllbGRzIiwic2V0Tm9kZXMiLCJzd2FwVXBsb2FkIiwiUmVhY3QiLCJjb2xsZWN0aW9uQ29uZmlnIiwiZG9jSUQiLCJ0ZXh0IiwidHlwZSIsImN1c3RvbUZpZWxkcyIsImFkbWluIiwidXBsb2FkIiwiZGl2IiwiY2xhc3NOYW1lIiwiZmlsdGVyIiwiQm9vbGVhbiIsImpvaW4iLCJjb250ZW50RWRpdGFibGUiLCJpbWciLCJhbHQiLCJmaWxlbmFtZSIsInNyYyIsIkZpbGVHcmFwaGljIiwiZ2V0VHJhbnNsYXRpb24iLCJsYWJlbHMiLCJzaW5ndWxhciIsImxlbmd0aCIsIkRyYXdlclRvZ2dsZXIiLCJkaXNhYmxlZCIsInJlYWRPbmx5IiwiQnV0dG9uIiwiYnV0dG9uU3R5bGUiLCJlbCIsImljb24iLCJvbkNsaWNrIiwiZSIsInByZXZlbnREZWZhdWx0Iiwicm91bmQiLCJ0b29sdGlwIiwic3Ryb25nIiwib25TYXZlIiwib25TZWxlY3QiLCJVcGxvYWREcmF3ZXIiLCJFbmFibGVkUmVsYXRpb25zaGlwc0NvbmRpdGlvbiIsInVwbG9hZHMiXSwibWFwcGluZ3MiOiI7Ozs7K0JBMk5BOzs7ZUFBQTs7OzRCQXhOdUI7MEJBTWhCOzBCQUNxQjt1QkFDZ0I7MkJBQ2xCOzRCQUNLOytEQUMwQjs4QkFDMUI7dUJBQ0o7NEJBQzBDOytDQUl2Qjs4QkFDakI7UUFDdEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFUCxNQUFNQSxZQUFZO0FBRWxCLE1BQU1DLGdCQUFnQjtJQUNwQkMsT0FBTztBQUNUO0FBVUEsTUFB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