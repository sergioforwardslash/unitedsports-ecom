"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _breadcrumbs = /*#__PURE__*/ _interop_require_default(require("./fields/breadcrumbs"));
const _parent = /*#__PURE__*/ _interop_require_default(require("./fields/parent"));
const _resaveChildren = /*#__PURE__*/ _interop_require_default(require("./hooks/resaveChildren"));
const _resaveSelfAfterCreate = /*#__PURE__*/ _interop_require_default(require("./hooks/resaveSelfAfterCreate"));
const _populateBreadcrumbs = /*#__PURE__*/ _interop_require_default(require("./utilities/populateBreadcrumbs"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const nestedDocs = (pluginConfig)=>(config)=>({
            ...config,
            collections: (config.collections || []).map((collection)=>{
                if (pluginConfig.collections.indexOf(collection.slug) > -1) {
                    const fields = [
                        ...collection?.fields || []
                    ];
                    if (!pluginConfig.parentFieldSlug) {
                        fields.push((0, _parent.default)(collection.slug));
                    }
                    if (!pluginConfig.breadcrumbsFieldSlug) {
                        fields.push((0, _breadcrumbs.default)(collection.slug));
                    }
                    return {
                        ...collection,
                        hooks: {
                            ...collection.hooks || {},
                            beforeChange: [
                                async ({ req, data, originalDoc })=>(0, _populateBreadcrumbs.default)(req, pluginConfig, collection, data, originalDoc),
                                ...collection?.hooks?.beforeChange || []
                            ],
                            afterChange: [
                                (0, _resaveChildren.default)(pluginConfig, collection),
                                (0, _resaveSelfAfterCreate.default)(collection),
                                ...collection?.hooks?.afterChange || []
                            ]
                        },
                        fields
                    };
                }
                return collection;
            })
        });
const _default = nestedDocs;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFBsdWdpbiB9IGZyb20gJ3BheWxvYWQvY29uZmlnJ1xuXG5pbXBvcnQgdHlwZSB7IFBsdWdpbkNvbmZpZyB9IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCBjcmVhdGVCcmVhZGNydW1ic0ZpZWxkIGZyb20gJy4vZmllbGRzL2JyZWFkY3J1bWJzJ1xuaW1wb3J0IGNyZWF0ZVBhcmVudEZpZWxkIGZyb20gJy4vZmllbGRzL3BhcmVudCdcbmltcG9ydCByZXNhdmVDaGlsZHJlbiBmcm9tICcuL2hvb2tzL3Jlc2F2ZUNoaWxkcmVuJ1xuaW1wb3J0IHJlc2F2ZVNlbGZBZnRlckNyZWF0ZSBmcm9tICcuL2hvb2tzL3Jlc2F2ZVNlbGZBZnRlckNyZWF0ZSdcbmltcG9ydCBwb3B1bGF0ZUJyZWFkY3J1bWJzIGZyb20gJy4vdXRpbGl0aWVzL3BvcHVsYXRlQnJlYWRjcnVtYnMnXG5cbmNvbnN0IG5lc3RlZERvY3MgPVxuICAocGx1Z2luQ29uZmlnOiBQbHVnaW5Db25maWcpOiBQbHVnaW4gPT5cbiAgKGNvbmZpZykgPT4gKHtcbiAgICAuLi5jb25maWcsXG4gICAgY29sbGVjdGlvbnM6IChjb25maWcuY29sbGVjdGlvbnMgfHwgW10pLm1hcCgoY29sbGVjdGlvbikgPT4ge1xuICAgICAgaWYgKHBsdWdpbkNvbmZpZy5jb2xsZWN0aW9ucy5pbmRleE9mKGNvbGxlY3Rpb24uc2x1ZykgPiAtMSkge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSBbLi4uKGNvbGxlY3Rpb24/LmZpZWxkcyB8fCBbXSldXG5cbiAgICAgICAgaWYgKCFwbHVnaW5Db25maWcucGFyZW50RmllbGRTbHVnKSB7XG4gICAgICAgICAgZmllbGRzLnB1c2goY3JlYXRlUGFyZW50RmllbGQoY29sbGVjdGlvbi5zbHVnKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcGx1Z2luQ29uZmlnLmJyZWFkY3J1bWJzRmllbGRTbHVnKSB7XG4gICAgICAgICAgZmllbGRzLnB1c2goY3JlYXRlQnJlYWRjcnVtYnNGaWVsZChjb2xsZWN0aW9uLnNsdWcpKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5jb2xsZWN0aW9uLFxuICAgICAgICAgIGhvb2tzOiB7XG4gICAgICAgICAgICAuLi4oY29sbGVjdGlvbi5ob29rcyB8fCB7fSksXG4gICAgICAgICAgICBiZWZvcmVDaGFuZ2U6IFtcbiAgICAgICAgICAgICAgYXN5bmMgKHsgcmVxLCBkYXRhLCBvcmlnaW5hbERvYyB9KSA9PlxuICAgICAgICAgICAgICAgIHBvcHVsYXRlQnJlYWRjcnVtYnMocmVxLCBwbHVnaW5Db25maWcsIGNvbGxlY3Rpb24sIGRhdGEsIG9yaWdpbmFsRG9jKSxcbiAgICAgICAgICAgICAgLi4uKGNvbGxlY3Rpb24/Lmhvb2tzPy5iZWZvcmVDaGFuZ2UgfHwgW10pLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGFmdGVyQ2hhbmdlOiBbXG4gICAgICAgICAgICAgIHJlc2F2ZUNoaWxkcmVuKHBsdWdpbkNvbmZpZywgY29sbGVjdGlvbiksXG4gICAgICAgICAgICAgIHJlc2F2ZVNlbGZBZnRlckNyZWF0ZShjb2xsZWN0aW9uKSxcbiAgICAgICAgICAgICAgLi4uKGNvbGxlY3Rpb24/Lmhvb2tzPy5hZnRlckNoYW5nZSB8fCBbXSksXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmllbGRzLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb2xsZWN0aW9uXG4gICAgfSksXG4gIH0pXG5cbmV4cG9ydCBkZWZhdWx0IG5lc3RlZERvY3NcbiJdLCJuYW1lcyI6WyJuZXN0ZWREb2NzIiwicGx1Z2luQ29uZmlnIiwiY29uZmlnIiwiY29sbGVjdGlvbnMiLCJtYXAiLCJjb2xsZWN0aW9uIiwiaW5kZXhPZiIsInNsdWciLCJmaWVsZHMiLCJwYXJlbnRGaWVsZFNsdWciLCJwdXNoIiwiY3JlYXRlUGFyZW50RmllbGQiLCJicmVhZGNydW1ic0ZpZWxkU2x1ZyIsImNyZWF0ZUJyZWFkY3J1bWJzRmllbGQiLCJob29rcyIsImJlZm9yZUNoYW5nZSIsInJlcSIsImRhdGEiLCJvcmlnaW5hbERvYyIsInBvcHVsYXRlQnJlYWRjcnVtYnMiLCJhZnRlckNoYW5nZSIsInJlc2F2ZUNoaWxkcmVuIiwicmVzYXZlU2VsZkFmdGVyQ3JlYXRlIl0sIm1hcHBpbmdzIjoiOzs7OytCQWlEQTs7O2VBQUE7OztvRUE3Q21DOytEQUNMO3VFQUNIOzhFQUNPOzRFQUNGOzs7Ozs7QUFFaEMsTUFBTUEsYUFDSixDQUFDQyxlQUNELENBQUNDLFNBQVksQ0FBQTtZQUNYLEdBQUdBLE1BQU07WUFDVEMsYUFBYSxBQUFDRCxDQUFBQSxPQUFPQyxXQUFXLElBQUksRUFBRSxBQUFELEVBQUdDLEdBQUcsQ0FBQyxDQUFDQztnQkFDM0MsSUFBSUosYUFBYUUsV0FBVyxDQUFDRyxPQUFPLENBQUNELFdBQVdFLElBQUksSUFBSSxDQUFDLEdBQUc7b0JBQzFELE1BQU1DLFNBQVM7MkJBQUtILFlBQVlHLFVBQVUsRUFBRTtxQkFBRTtvQkFFOUMsSUFBSSxDQUFDUCxhQUFhUSxlQUFlLEVBQUU7d0JBQ2pDRCxPQUFPRSxJQUFJLENBQUNDLElBQUFBLGVBQWlCLEVBQUNOLFdBQVdFLElBQUk7b0JBQy9DO29CQUVBLElBQUksQ0FBQ04sYUFBYVcsb0JBQW9CLEVBQUU7d0JBQ3RDSixPQUFPRSxJQUFJLENBQUNHLElBQUFBLG9CQUFzQixFQUFDUixXQUFXRSxJQUFJO29CQUNwRDtvQkFFQSxPQUFPO3dCQUNMLEdBQUdGLFVBQVU7d0JBQ2JTLE9BQU87NEJBQ0wsR0FBSVQsV0FBV1MsS0FBSyxJQUFJLENBQUMsQ0FBQzs0QkFDMUJDLGNBQWM7Z0NBQ1osT0FBTyxFQUFFQyxHQUFHLEVBQUVDLElBQUksRUFBRUMsV0FBVyxFQUFFLEdBQy9CQyxJQUFBQSw0QkFBbUIsRUFBQ0gsS0FBS2YsY0FBY0ksWUFBWVksTUFBTUM7bUNBQ3ZEYixZQUFZUyxPQUFPQyxnQkFBZ0IsRUFBRTs2QkFDMUM7NEJBQ0RLLGFBQWE7Z0NBQ1hDLElBQUFBLHVCQUFjLEVBQUNwQixjQUFjSTtnQ0FDN0JpQixJQUFBQSw4QkFBcUIsRUFBQ2pCO21DQUNsQkEsWUFBWVMsT0FBT00sZUFBZSxFQUFFOzZCQUN6Qzt3QkFDSDt3QkFDQVo7b0JBQ0Y7Z0JBQ0Y7Z0JBRUEsT0FBT0g7WUFDVDtRQUNGLENBQUE7TUFFRixXQUFlTCJ9